<html>
    <head>
        <title>micro:bit</title>
        <script type="text/javascript" src="../dist/microbit.umd.js"></script>
    </head>
    <body>
        <button id="connect">Connect</button>

        <div id="log" style="white-space: pre" />
        <script>
            const logEl = document.getElementById("log");
            const log = (message) => logEl.innerHTML = `${message}\n${logEl.innerHTML}`;
            const logJson = (message) => log(JSON.stringify(message, null, 2));
            const eventHandler = event => log(`${event.type}: ${JSON.stringify(event.detail, null, 2)}`);

            document.getElementById("connect").onclick = async () => {
                const device = await microbit.requestMicrobit(window.navigator.bluetooth);
                if (device) {
                    const services = await microbit.getServices(device);


                    if (services.uartService) {
                        services.uartService.addEventListener("receiveText", eventHandler);
                        await services.uartService.send(new Uint8Array([104, 101, 108, 108, 111, 35])); // hello#
                    }

                }
            }

        </script>
    </body>
</html>
